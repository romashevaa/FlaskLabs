{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
  <div class="my-posts">
    <h1 class="mb-4 text-center">My Posts</h1>
    <div class="row justify-content-center">
      <ul class="col-md-8 list-group">
        {% for post in user_posts.items %}
        <li class="list-group-item mb-3">
          {% with user = post.get_user() %}
          <div class="user-info d-flex align-items-center mb-3">
            <img src="{{ url_for('static', filename='../static/profile_images/' + user.image_file) }}"
              class="rounded-circle" alt="User Avatar" width="32" height="32">
            <span class="ml-2">{{ user.username }}</span>
          </div>
          {% endwith %}

          <h3 class="my-2">{{ post.title }}</h3>
          <p class="mb-2">{{ post.text }}</p>

          {% if post.image %}
          <div class="post-image text-center">
            <img src="{{ url_for('static', filename='../static/post_images/' + post.image) }}" class="img-fluid mb-2"
              alt="Post Image">
          </div>
          {% endif %}

          <div class="post-details">
            <p class="mb-2"><strong>Category:</strong> {{ post.category.name }}</p>
            <p class="mb-2"><strong>Type:</strong> {{ post.type }}</p>

            {% if post.tags %}
            <p><strong>Tags:</strong>
              {% for tag in post.tags %}
              <span class="badge badge-primary">{{ tag.name }}</span>
              {% endfor %}
            </p>
            {% endif %}

            <p class="mb-2"><strong>Created:</strong> {{ post.created }}</p>
          </div>

          <div class="btn-group" role="group" aria-label="Post Actions">
            <a href="{{ url_for('posts.edit_post', id=post.id) }}" class="btn btn-warning btn-sm">Edit</a>
            <a href="{{ url_for('posts.delete_post', id=post.id) }}"
              onclick="return confirm('Are you sure you want to delete this post?');"
              class="btn btn-danger btn-sm">Delete</a>
          </div>
        </li>
        {% endfor %}
      </ul>
    </div>

    <nav aria-label="Page navigation" class="d-flex justify-content-center">
      <ul class="pagination mt-4">
        {%- for page_num in user_posts.iter_pages() %}
        {% if page_num %}
        {% if user_posts.page == page_num %}
        <li class="page-item active" aria-current="page">
          <span class="page-link">{{ page_num }}<span class="visually-hidden"></span></span>
        </li>
        {% else %}
        <li class="page-item"><a class="page-link" href="{{ url_for('posts.my_posts', page=page_num) }}">{{ page_num
            }}</a></li>
        {% endif %}
        {% else %}
        <li class="page-item disabled"><span class="page-link">...</span></li>
        {% endif %}
        {%- endfor %}
      </ul>
    </nav>
  </div>
</div>
{% endblock %}